var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
import { Container, inject, injectable } from 'inversify';
import { CsInjectionTokens, InjectionTokens } from '../../injection-tokens';
import { CachedItemRequestSourceFrom } from '../../key-value-store';
import { GroupActivityServiceImpl } from './group-activity-service-impl';
var GroupServiceImpl = /** @class */ (function () {
    function GroupServiceImpl(container, cachedItemStore) {
        this.container = container;
        this.cachedItemStore = cachedItemStore;
    }
    GroupServiceImpl_1 = GroupServiceImpl;
    Object.defineProperty(GroupServiceImpl.prototype, "activityService", {
        get: function () {
            if (!this._groupActivityService) {
                this._groupActivityService = new GroupActivityServiceImpl(this.groupServiceDelegate.activityService, this.cachedItemStore);
            }
            return this._groupActivityService;
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(GroupServiceImpl.prototype, "groupServiceDelegate", {
        get: function () {
            return this.container.get(CsInjectionTokens.GROUP_SERVICE);
        },
        enumerable: false,
        configurable: true
    });
    GroupServiceImpl.prototype.create = function (request) {
        return this.groupServiceDelegate.create(request);
    };
    GroupServiceImpl.prototype.getById = function (request) {
        var _this = this;
        return this.cachedItemStore[request.from === CachedItemRequestSourceFrom.SERVER ? 'get' : 'getCached'](request.id + "-" + request.userId +
            ("" + ((request.options && request.options.includeMembers) ? '-includeMembers:' + request.options.includeMembers : '')) +
            ("" + ((request.options && request.options.includeActivities) ? '-includeActivities:' + request.options.includeActivities : '')) +
            ("" + ((request.options && request.options.groupActivities) ? '-groupActivities:' + request.options.groupActivities : '')), GroupServiceImpl_1.GROUP_LOCAL_KEY, 'ttl_' + GroupServiceImpl_1.GROUP_LOCAL_KEY, function () { return _this.groupServiceDelegate.getById(request.id, request.options); });
    };
    GroupServiceImpl.prototype.search = function (_a) {
        var _this = this;
        var request = _a.request, from = _a.from;
        return this.cachedItemStore[from === CachedItemRequestSourceFrom.SERVER ? 'get' : 'getCached']("" + request.filters.userId, GroupServiceImpl_1.GROUP_SEARCH_LOCAL_KEY, 'ttl_' + GroupServiceImpl_1.GROUP_SEARCH_LOCAL_KEY, function () { return _this.groupServiceDelegate.search(request); });
    };
    GroupServiceImpl.prototype.updateById = function (request) {
        return this.groupServiceDelegate.updateById(request.id, request.updateRequest);
    };
    GroupServiceImpl.prototype.deleteById = function (request) {
        return this.groupServiceDelegate.deleteById(request.id);
    };
    GroupServiceImpl.prototype.addMembers = function (request) {
        return this.groupServiceDelegate.addMembers(request.groupId, request.addMembersRequest);
    };
    GroupServiceImpl.prototype.updateMembers = function (request) {
        return this.groupServiceDelegate.updateMembers(request.groupId, request.updateMembersRequest);
    };
    GroupServiceImpl.prototype.removeMembers = function (request) {
        return this.groupServiceDelegate.removeMembers(request.groupId, request.removeMembersRequest);
    };
    GroupServiceImpl.prototype.addActivities = function (request) {
        return this.groupServiceDelegate.addActivities(request.groupId, request.addActivitiesRequest);
    };
    GroupServiceImpl.prototype.updateActivities = function (request) {
        return this.groupServiceDelegate.updateActivities(request.groupId, request.updateActivitiesRequest);
    };
    GroupServiceImpl.prototype.removeActivities = function (request) {
        return this.groupServiceDelegate.removeActivities(request.groupId, request.removeActivitiesRequest);
    };
    GroupServiceImpl.prototype.getSupportedActivities = function () {
        return this.groupServiceDelegate.getSupportedActivities();
    };
    GroupServiceImpl.prototype.suspendById = function (request) {
        return this.groupServiceDelegate.suspendById(request.id);
    };
    GroupServiceImpl.prototype.reactivateById = function (request) {
        return this.groupServiceDelegate.reactivateById(request.id);
    };
    GroupServiceImpl.prototype.updateGroupGuidelines = function (request) {
        return this.groupServiceDelegate.updateGroupGuidelines(request);
    };
    var GroupServiceImpl_1;
    GroupServiceImpl.GROUP_LOCAL_KEY = 'GROUP-';
    GroupServiceImpl.GROUP_SEARCH_LOCAL_KEY = 'GROUP_SEARCH-';
    GroupServiceImpl = GroupServiceImpl_1 = __decorate([
        injectable(),
        __param(0, inject(InjectionTokens.CONTAINER)),
        __param(1, inject(InjectionTokens.CACHED_ITEM_STORE)),
        __metadata("design:paramtypes", [Container, Object])
    ], GroupServiceImpl);
    return GroupServiceImpl;
}());
export { GroupServiceImpl };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ3JvdXAtc2VydmljZS1pbXBsLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL2dyb3VwL2ltcGwvZ3JvdXAtc2VydmljZS1pbXBsLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7OztBQTZCQSxPQUFPLEVBQUMsU0FBUyxFQUFFLE1BQU0sRUFBRSxVQUFVLEVBQUMsTUFBTSxXQUFXLENBQUM7QUFDeEQsT0FBTyxFQUFDLGlCQUFpQixFQUFFLGVBQWUsRUFBQyxNQUFNLHdCQUF3QixDQUFDO0FBRTFFLE9BQU8sRUFBQywyQkFBMkIsRUFBa0IsTUFBTSx1QkFBdUIsQ0FBQztBQUNuRixPQUFPLEVBQUMsd0JBQXdCLEVBQUMsTUFBTSwrQkFBK0IsQ0FBQztBQU12RTtJQWlCSSwwQkFDK0MsU0FBb0IsRUFDWixlQUFnQztRQUR4QyxjQUFTLEdBQVQsU0FBUyxDQUFXO1FBQ1osb0JBQWUsR0FBZixlQUFlLENBQWlCO0lBRXZGLENBQUM7eUJBckJRLGdCQUFnQjtJQU16QixzQkFBSSw2Q0FBZTthQUFuQjtZQUNJLElBQUksQ0FBQyxJQUFJLENBQUMscUJBQXFCLEVBQUU7Z0JBQzdCLElBQUksQ0FBQyxxQkFBcUIsR0FBRyxJQUFJLHdCQUF3QixDQUNyRCxJQUFJLENBQUMsb0JBQW9CLENBQUMsZUFBZSxFQUN6QyxJQUFJLENBQUMsZUFBZSxDQUN2QixDQUFDO2FBQ0w7WUFFRCxPQUFPLElBQUksQ0FBQyxxQkFBcUIsQ0FBQztRQUN0QyxDQUFDOzs7T0FBQTtJQVFELHNCQUFZLGtEQUFvQjthQUFoQztZQUNJLE9BQU8sSUFBSSxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsaUJBQWlCLENBQUMsYUFBYSxDQUFDLENBQUM7UUFDL0QsQ0FBQzs7O09BQUE7SUFFRCxpQ0FBTSxHQUFOLFVBQU8sT0FBMkI7UUFDOUIsT0FBTyxJQUFJLENBQUMsb0JBQW9CLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDO0lBQ3JELENB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LENBQUMsQ0FBQTtRQUNqQyxXQUFBLE1BQU0sQ0FBQyxlQUFlLENBQUMsaUJBQWlCLENBQUMsQ0FBQTt5Q0FEWSxTQUFTO09BbEIxRCxnQkFBZ0IsQ0FvRzVCO0lBQUQsdUJBQUM7Q0FBQSxBQXBHRCxJQW9HQztTQXBHWSxnQkFBZ0IiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICAgIEFkZEFjdGl2aXRpZXNSZXF1ZXN0LFxuICAgIEFkZE1lbWJlcnNSZXF1ZXN0LFxuICAgIERlbGV0ZUJ5SWRSZXF1ZXN0LFxuICAgIEdldEJ5SWRSZXF1ZXN0LFxuICAgIEdyb3VwQWN0aXZpdHlTZXJ2aWNlLFxuICAgIEdyb3VwQWRkQWN0aXZpdGllc1Jlc3BvbnNlLFxuICAgIEdyb3VwQWRkTWVtYmVyc1Jlc3BvbnNlLFxuICAgIEdyb3VwQ3JlYXRlUmVxdWVzdCxcbiAgICBHcm91cENyZWF0ZVJlc3BvbnNlLFxuICAgIEdyb3VwRGVsZXRlUmVzcG9uc2UsXG4gICAgR3JvdXBSZW1vdmVBY3Rpdml0aWVzUmVzcG9uc2UsXG4gICAgR3JvdXBSZW1vdmVNZW1iZXJzUmVzcG9uc2UsXG4gICAgR3JvdXBTZWFyY2hDcml0ZXJpYSxcbiAgICBHcm91cFNlYXJjaFJlc3BvbnNlLFxuICAgIEdyb3VwU2VydmljZSxcbiAgICBHcm91cFN1cHBvcnRlZEFjdGl2aXRpZXNGb3JtRmllbGQsXG4gICAgR3JvdXBVcGRhdGVBY3Rpdml0aWVzUmVzcG9uc2UsXG4gICAgR3JvdXBVcGRhdGVNZW1iZXJzUmVzcG9uc2UsXG4gICAgR3JvdXBVcGRhdGVSZXNwb25zZSxcbiAgICBSZW1vdmVBY3Rpdml0aWVzUmVxdWVzdCxcbiAgICBSZW1vdmVNZW1iZXJzUmVxdWVzdCxcbiAgICBVcGRhdGVBY3Rpdml0aWVzUmVxdWVzdCxcbiAgICBVcGRhdGVCeUlkUmVxdWVzdCxcbiAgICBVcGRhdGVNZW1iZXJzUmVxdWVzdFxufSBmcm9tICcuLic7XG5pbXBvcnQge09ic2VydmFibGV9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHtHcm91cCwgR3JvdXBFbnRpdHlTdGF0dXN9IGZyb20gJy4uL2RlZi9tb2RlbHMnO1xuaW1wb3J0IHtGb3JtfSBmcm9tICcuLi8uLi9mb3JtL2RlZi9tb2RlbHMnO1xuaW1wb3J0IHtDb250YWluZXIsIGluamVjdCwgaW5qZWN0YWJsZX0gZnJvbSAnaW52ZXJzaWZ5JztcbmltcG9ydCB7Q3NJbmplY3Rpb25Ub2tlbnMsIEluamVjdGlvblRva2Vuc30gZnJvbSAnLi4vLi4vaW5qZWN0aW9uLXRva2Vucyc7XG5pbXBvcnQge0NzR3JvdXBTZXJ2aWNlLCBDc0dyb3VwVXBkYXRlR3JvdXBHdWlkZWxpbmVzUmVxdWVzdCwgQ3NHcm91cFVwZGF0ZUdyb3VwR3VpZGVsaW5lc1Jlc3BvbnNlfSBmcm9tICdAcHJvamVjdC1zdW5iaXJkL2NsaWVudC1zZXJ2aWNlcy9zZXJ2aWNlcy9ncm91cCc7XG5pbXBvcnQge0NhY2hlZEl0ZW1SZXF1ZXN0U291cmNlRnJvbSwgQ2FjaGVkSXRlbVN0b3JlfSBmcm9tICcuLi8uLi9rZXktdmFsdWUtc3RvcmUnO1xuaW1wb3J0IHtHcm91cEFjdGl2aXR5U2VydmljZUltcGx9IGZyb20gJy4vZ3JvdXAtYWN0aXZpdHktc2VydmljZS1pbXBsJztcbmltcG9ydCB7IENzR3JvdXBTZXJ2aWNlQ29uZmlnIH0gZnJvbSAnQHByb2plY3Qtc3VuYmlyZC9jbGllbnQtc2VydmljZXMnO1xuaW1wb3J0IHsgQWN0aXZhdGVBbmREZWFjdGl2YXRlQnlJZFJlcXVlc3QgfSBmcm9tICcuLi9kZWYvcmVxdWVzdHMnO1xuaW1wb3J0IHsgR3JvdXBSZWFjdGl2YXRlUmVzcG9uc2UsIEdyb3VwU3VzcGVuZFJlc3BvbnNlIH0gZnJvbSAnLi4vZGVmL3Jlc3BvbnNlcyc7XG5cbkBpbmplY3RhYmxlKClcbmV4cG9ydCBjbGFzcyBHcm91cFNlcnZpY2VJbXBsIGltcGxlbWVudHMgR3JvdXBTZXJ2aWNlIHtcbiAgICBwcml2YXRlIHN0YXRpYyBHUk9VUF9MT0NBTF9LRVkgPSAnR1JPVVAtJztcbiAgICBwcml2YXRlIHN0YXRpYyBHUk9VUF9TRUFSQ0hfTE9DQUxfS0VZID0gJ0dST1VQX1NFQVJDSC0nO1xuXG4gICAgcHJpdmF0ZSBfZ3JvdXBBY3Rpdml0eVNlcnZpY2U6IEdyb3VwQWN0aXZpdHlTZXJ2aWNlO1xuXG4gICAgZ2V0IGFjdGl2aXR5U2VydmljZSgpOiBHcm91cEFjdGl2aXR5U2VydmljZSB7XG4gICAgICAgIGlmICghdGhpcy5fZ3JvdXBBY3Rpdml0eVNlcnZpY2UpIHtcbiAgICAgICAgICAgIHRoaXMuX2dyb3VwQWN0aXZpdHlTZXJ2aWNlID0gbmV3IEdyb3VwQWN0aXZpdHlTZXJ2aWNlSW1wbChcbiAgICAgICAgICAgICAgICB0aGlzLmdyb3VwU2VydmljZURlbGVnYXRlLmFjdGl2aXR5U2VydmljZSxcbiAgICAgICAgICAgICAgICB0aGlzLmNhY2hlZEl0ZW1TdG9yZVxuICAgICAgICAgICAgKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB0aGlzLl9ncm91cEFjdGl2aXR5U2VydmljZTtcbiAgICB9XG5cbiAgICBjb25zdHJ1Y3RvcihcbiAgICAgICAgQGluamVjdChJbmplY3Rpb25Ub2tlbnMuQ09OVEFJTkVSKSBwcml2YXRlIGNvbnRhaW5lcjogQ29udGFpbmVyLFxuICAgICAgICBAaW5qZWN0KEluamVjdGlvblRva2Vucy5DQUNIRURfSVRFTV9TVE9SRSkgcHJpdmF0ZSBjYWNoZWRJdGVtU3RvcmU6IENhY2hlZEl0ZW1TdG9yZVxuICAgICkge1xuICAgIH1cblxuICAgIHByaXZhdGUgZ2V0IGdyb3VwU2VydmljZURlbGVnYXRlKCk6IENzR3JvdXBTZXJ2aWNlIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY29udGFpbmVyLmdldChDc0luamVjdGlvblRva2Vucy5HUk9VUF9TRVJWSUNFKTtcbiAgICB9XG5cbiAgICBjcmVhdGUocmVxdWVzdDogR3JvdXBDcmVhdGVSZXF1ZXN0KTogT2JzZXJ2YWJsZTxHcm91cENyZWF0ZVJlc3BvbnNlPiB7XG4gICAgICAgIHJldHVybiB0aGlzLmdyb3VwU2VydmljZURlbGVnYXRlLmNyZWF0ZShyZXF1ZXN0KTtcbiAgICB9XG5cbiAgICBnZXRCeUlkKHJlcXVlc3Q6IEdldEJ5SWRSZXF1ZXN0KTogT2JzZXJ2YWJsZTxHcm91cD4ge1xuICAgICAgICByZXR1cm4gdGhpcy5jYWNoZWRJdGVtU3RvcmVbcmVxdWVzdC5mcm9tID09PSBDYWNoZWRJdGVtUmVxdWVzdFNvdXJjZUZyb20uU0VSVkVSID8gJ2dldCcgOiAnZ2V0Q2FjaGVkJ10oXG4gICAgICAgICAgICBgJHtyZXF1ZXN0LmlkfS0ke3JlcXVlc3QudXNlcklkfWAgK1xuICAgICAgICAgICAgYCR7KHJlcXVlc3Qub3B0aW9ucyAmJiByZXF1ZXN0Lm9wdGlvbnMuaW5jbHVkZU1lbWJlcnMpID8gJy1pbmNsdWRlTWVtYmVyczonICsgcmVxdWVzdC5vcHRpb25zLmluY2x1ZGVNZW1iZXJzIDogJyd9YCArXG4gICAgICAgICAgICBgJHsocmVxdWVzdC5vcHRpb25zICYmIHJlcXVlc3Qub3B0aW9ucy5pbmNsdWRlQWN0aXZpdGllcykgPyAnLWluY2x1ZGVBY3Rpdml0aWVzOicgKyByZXF1ZXN0Lm9wdGlvbnMuaW5jbHVkZUFjdGl2aXRpZXMgOiAnJ31gICtcbiAgICAgICAgICAgIGAkeyhyZXF1ZXN0Lm9wdGlvbnMgJiYgcmVxdWVzdC5vcHRpb25zLmdyb3VwQWN0aXZpdGllcykgPyAnLWdyb3VwQWN0aXZpdGllczonICsgcmVxdWVzdC5vcHRpb25zLmdyb3VwQWN0aXZpdGllcyA6ICcnfWAsXG4gICAgICAgICAgICBHcm91cFNlcnZpY2VJbXBsLkdST1VQX0xPQ0FMX0tFWSxcbiAgICAgICAgICAgICd0dGxfJyArIEdyb3VwU2VydmljZUltcGwuR1JPVVBfTE9DQUxfS0VZLFxuICAgICAgICAgICAgKCkgPT4gdGhpcy5ncm91cFNlcnZpY2VEZWxlZ2F0ZS5nZXRCeUlkKHJlcXVlc3QuaWQsIHJlcXVlc3Qub3B0aW9ucyksXG4gICAgICAgICk7XG4gICAgfVxuXG4gICAgc2VhcmNoKHtyZXF1ZXN0LCBmcm9tfTogR3JvdXBTZWFyY2hDcml0ZXJpYSk6IE9ic2VydmFibGU8R3JvdXBTZWFyY2hSZXNwb25zZVtdPiB7XG4gICAgICAgIHJldHVybiB0aGlzLmNhY2hlZEl0ZW1TdG9yZVtmcm9tID09PSBDYWNoZWRJdGVtUmVxdWVzdFNvdXJjZUZyb20uU0VSVkVSID8gJ2dldCcgOiAnZ2V0Q2FjaGVkJ10oXG4gICAgICAgICAgICBgJHtyZXF1ZXN0LmZpbHRlcnMudXNlcklkfWAsXG4gICAgICAgICAgICBHcm91cFNlcnZpY2VJbXBsLkdST1VQX1NFQVJDSF9MT0NBTF9LRVksXG4gICAgICAgICAgICAndHRsXycgKyBHcm91cFNlcnZpY2VJbXBsLkdST1VQX1NFQVJDSF9MT0NBTF9LRVksXG4gICAgICAgICAgICAoKSA9PiB0aGlzLmdyb3VwU2VydmljZURlbGVnYXRlLnNlYXJjaChyZXF1ZXN0KSxcbiAgICAgICAgKTtcbiAgICB9XG5cbiAgICB1cGRhdGVCeUlkKHJlcXVlc3Q6IFVwZGF0ZUJ5SWRSZXF1ZXN0KTogT2JzZXJ2YWJsZTxHcm91cFVwZGF0ZVJlc3BvbnNlPiB7XG4gICAgICAgIHJldHVybiB0aGlzLmdyb3VwU2VydmljZURlbGVnYXRlLnVwZGF0ZUJ5SWQocmVxdWVzdC5pZCwgcmVxdWVzdC51cGRhdGVSZXF1ZXN0KTtcbiAgICB9XG5cbiAgICBkZWxldGVCeUlkKHJlcXVlc3Q6IERlbGV0ZUJ5SWRSZXF1ZXN0KTogT2JzZXJ2YWJsZTxHcm91cERlbGV0ZVJlc3BvbnNlPiB7XG4gICAgICAgIHJldHVybiB0aGlzLmdyb3VwU2VydmljZURlbGVnYXRlLmRlbGV0ZUJ5SWQocmVxdWVzdC5pZCk7XG4gICAgfVxuXG4gICAgYWRkTWVtYmVycyhyZXF1ZXN0OiBBZGRNZW1iZXJzUmVxdWVzdCk6IE9ic2VydmFibGU8R3JvdXBBZGRNZW1iZXJzUmVzcG9uc2U+IHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZ3JvdXBTZXJ2aWNlRGVsZWdhdGUuYWRkTWVtYmVycyhyZXF1ZXN0Lmdyb3VwSWQsIHJlcXVlc3QuYWRkTWVtYmVyc1JlcXVlc3QpO1xuICAgIH1cblxuICAgIHVwZGF0ZU1lbWJlcnMocmVxdWVzdDogVXBkYXRlTWVtYmVyc1JlcXVlc3QpOiBPYnNlcnZhYmxlPEdyb3VwVXBkYXRlTWVtYmVyc1Jlc3BvbnNlPiB7XG4gICAgICAgIHJldHVybiB0aGlzLmdyb3VwU2VydmljZURlbGVnYXRlLnVwZGF0ZU1lbWJlcnMocmVxdWVzdC5ncm91cElkLCByZXF1ZXN0LnVwZGF0ZU1lbWJlcnNSZXF1ZXN0KTtcbiAgICB9XG5cbiAgICByZW1vdmVNZW1iZXJzKHJlcXVlc3Q6IFJlbW92ZU1lbWJlcnNSZXF1ZXN0KTogT2JzZXJ2YWJsZTxHcm91cFJlbW92ZU1lbWJlcnNSZXNwb25zZT4ge1xuICAgICAgICByZXR1cm4gdGhpcy5ncm91cFNlcnZpY2VEZWxlZ2F0ZS5yZW1vdmVNZW1iZXJzKHJlcXVlc3QuZ3JvdXBJZCwgcmVxdWVzdC5yZW1vdmVNZW1iZXJzUmVxdWVzdCk7XG4gICAgfVxuXG4gICAgYWRkQWN0aXZpdGllcyhyZXF1ZXN0OiBBZGRBY3Rpdml0aWVzUmVxdWVzdCk6IE9ic2VydmFibGU8R3JvdXBBZGRBY3Rpdml0aWVzUmVzcG9uc2U+IHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZ3JvdXBTZXJ2aWNlRGVsZWdhdGUuYWRkQWN0aXZpdGllcyhyZXF1ZXN0Lmdyb3VwSWQsIHJlcXVlc3QuYWRkQWN0aXZpdGllc1JlcXVlc3QpO1xuICAgIH1cblxuICAgIHVwZGF0ZUFjdGl2aXRpZXMocmVxdWVzdDogVXBkYXRlQWN0aXZpdGllc1JlcXVlc3QpOiBPYnNlcnZhYmxlPEdyb3VwVXBkYXRlQWN0aXZpdGllc1Jlc3BvbnNlPiB7XG4gICAgICAgIHJldHVybiB0aGlzLmdyb3VwU2VydmljZURlbGVnYXRlLnVwZGF0ZUFjdGl2aXRpZXMocmVxdWVzdC5ncm91cElkLCByZXF1ZXN0LnVwZGF0ZUFjdGl2aXRpZXNSZXF1ZXN0KTtcbiAgICB9XG5cbiAgICByZW1vdmVBY3Rpdml0aWVzKHJlcXVlc3Q6IFJlbW92ZUFjdGl2aXRpZXNSZXF1ZXN0KTogT2JzZXJ2YWJsZTxHcm91cFJlbW92ZUFjdGl2aXRpZXNSZXNwb25zZT4ge1xuICAgICAgICByZXR1cm4gdGhpcy5ncm91cFNlcnZpY2VEZWxlZ2F0ZS5yZW1vdmVBY3Rpdml0aWVzKHJlcXVlc3QuZ3JvdXBJZCwgcmVxdWVzdC5yZW1vdmVBY3Rpdml0aWVzUmVxdWVzdCk7XG4gICAgfVxuXG4gICAgZ2V0U3VwcG9ydGVkQWN0aXZpdGllcygpOiBPYnNlcnZhYmxlPEZvcm08R3JvdXBTdXBwb3J0ZWRBY3Rpdml0aWVzRm9ybUZpZWxkPj4ge1xuICAgICAgICByZXR1cm4gdGhpcy5ncm91cFNlcnZpY2VEZWxlZ2F0ZS5nZXRTdXBwb3J0ZWRBY3Rpdml0aWVzKCk7XG4gICAgfVxuXG4gICAgc3VzcGVuZEJ5SWQocmVxdWVzdDogQWN0aXZhdGVBbmREZWFjdGl2YXRlQnlJZFJlcXVlc3QpOiBPYnNlcnZhYmxlPEdyb3VwU3VzcGVuZFJlc3BvbnNlPiB7XG4gICAgICAgIHJldHVybiB0aGlzLmdyb3VwU2VydmljZURlbGVnYXRlLnN1c3BlbmRCeUlkKHJlcXVlc3QuaWQpO1xuICAgIH1cblxuICAgIHJlYWN0aXZhdGVCeUlkKHJlcXVlc3Q6IEFjdGl2YXRlQW5kRGVhY3RpdmF0ZUJ5SWRSZXF1ZXN0KTogT2JzZXJ2YWJsZTxHcm91cFJlYWN0aXZhdGVSZXNwb25zZT4ge1xuICAgICAgICByZXR1cm4gdGhpcy5ncm91cFNlcnZpY2VEZWxlZ2F0ZS5yZWFjdGl2YXRlQnlJZChyZXF1ZXN0LmlkKTtcbiAgICB9XG5cbiAgICB1cGRhdGVHcm91cEd1aWRlbGluZXMocmVxdWVzdDogQ3NHcm91cFVwZGF0ZUdyb3VwR3VpZGVsaW5lc1JlcXVlc3QpOiBPYnNlcnZhYmxlPENzR3JvdXBVcGRhdGVHcm91cEd1aWRlbGluZXNSZXNwb25zZT4ge1xuICAgICAgICByZXR1cm4gdGhpcy5ncm91cFNlcnZpY2VEZWxlZ2F0ZS51cGRhdGVHcm91cEd1aWRlbGluZXMocmVxdWVzdCk7XG4gICAgfVxuXG59XG4iXX0=